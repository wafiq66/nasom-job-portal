server {
# Listen for standard HTTP traffic on port 80 (required for proxy)
listen 80;

# Replace these with your actual domain names for production
# For local testing, ensure 'localhost' is included here
server_name localhost mydomain.com www.mydomain.com; 

# 1. Handle Static Files (Served directly by Nginx for high performance)
location /static/ {
    # This 'alias' path must match the volume mount point in docker-compose.yml
    alias /vol/static/; 
    expires 30d; # Cache static files for a month
}

# 2. Handle Media Files (Served directly by Nginx for user uploads)
location /media/ {
    # This 'alias' path must match the volume mount point in docker-compose.yml
    alias /vol/media/;
    # You may want tighter security/timeouts for media uploads, but 50M body size is handled below
}

# 3. Handle Dynamic Requests (Proxy to Django/Gunicorn)
location / {
    # 'web' is the name of your Django service container
    proxy_pass http://web:8000;
    
    # Standard headers for proxying
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Timeout settings
    proxy_read_timeout 120s;
    proxy_connect_timeout 120s;

    # Max file size for uploads (needs to be outside location block for general setting)
    # Nginx documentation recommends placing client_max_body_size in the http or server block.
}

# Max file size for uploads (placed here for safety, though typically in http or server top-level)
client_max_body_size 50M; 


}